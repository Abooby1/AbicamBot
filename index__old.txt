 //time to convert everything here into commands and files

process.env.TZ = "America/New_York";
const { Client } = require("photop-client");
const mySecret = process.env['Pass'];
const mySecret2 = process.env['DataBase']

//the database part is fine cuz im not using it rn

//database
/*
const { DataBase } = require("cassandra-driver");

async function run() {
  const data = new DataBase({
    cloud: {
      secureConnectBundle: "path/to/secure-connect-abicambot.zip",
    },
    credentials: {
      username: "YzxkzQnEdmLBSDOopMjYLBdq",
      password: mySecret2,
    },
  });

  await data.connect();

  // Execute a query
  const rs = await data.execute("SELECT * FROM system.local");
  console.log(`Your cluster returned ${rs.rowLength} row(s)`);

  await data.shutdown();
}

// Run the async function
run();
*/

//data (replit)
const DB = require("@replit/database");
const db = new DB();

function getRandomInt(max) {
  return Math.floor(Math.random() * max);
}

//vars
const client = new Client({ username: "AbicamBot", password: mySecret }, { logSocketMessages: true }); 


// for hpa1,2,3,4 whatever, you should define it inside say, a text file instead of inside the code and a variable for each
// you can store it as a json array, and then parse it later
// ill show, you, by creating help.json
var Prefix = "ab!"
var UpdateNum = "V2.2.1"
var Update = UpdateNum + ": 1. Added Kimburlia"
var Likes = 0

var Hpa1 = "Commands: ab!robot_engine: I will chat something about Robot_engine | ab!wutbot: I will chat something about WUTBot | ab!pyx: I will chat something about Pyx"

var Hpa2 = "Commands: ab!like: You will like the bot | ab!likepost: I will like the post | ab!unlikepost: I will unlike the post"

var Hpa3 = "Commands: ab!random.num: I will chat a random number | ab!rank.info: I will chat your rank and some rank info"

var Hpb1 = "Commands: ab!money: I will chat the amount of money you have | ab!wins: I will chat how many wins you have | ab!work: you can work for money"

var Hpb2 = "Commands: ab!loses: I will chat the amount of loses you have | ab!gamble: If the bot has $5 or more you can gamble for money"

var Hpb3 = "Commands: ab!learn: You will get education points to earn more money from your work | ab!edu.points: I will chat how many edu points you have"

var Hpb4 = "Commands: ab!crypto.info: I will chat how much money Crypto is going for and how much Crypto you have | ab!post.money: I will chat how much post money you have!"

var Hpb5 = "Commands: ab!sell.crypto: You will sell all the Crypto in the bot | ab!buy.crypto: You will buy 1 Crypto | ab!play: You will play a game for happy points!"

var Hpb6 = "Commands: ab!happy.points: I will chat how many happy points you have! | ab!cook: You will cook and get food points | ab!food.points: I will chat how much food points you have"

var Hpc1 = "Commands: ab!buy.money1: You will buy $1 of gamble money! | ab!buy.money5: You will buy $5 of gamble money! | ab!level: I will chat your levels"

var Hpc2 = "Commands: ab!buy.post.money: You will buy $1 of post money with your levels | ab!event.claim: You will claim the event rewards!"

var Hpc3 = "Commands: ab!start: You will touch the event stone and probably open an event door!"

var Hpd1 = "Commands: ab!fight: You will fight for resources | ab!summon: You will summon energy | ab!energy: I will chat how much energy you have"

var Hpd2 = "Commands: ab!coins: I will chat how many coins you have | ab!scrolls: I will chat how many scrolls you have"

var Running = {
  Update: "AbicamBot is up and running with update " + UpdateNum + "! | (post ab!connect to connect! | Remember you earn post money and levels by using AbicamBot)",

  Normal: "AbicamBot is online! | Post ab!connect to connect!  | Remember you earn post money and levels by using AbicamBot",

  DataUpdate: "AbicamBot is up and running with update " + UpdateNum + "! | (post ab!connect to connect!) | Remember you earn money and levels by using AbicamBot) | NOTICE: please use ab!connect to update your AbicamBot account!",

  Downtime: "The bot is currently on downtime! (most likely a big update O.O) | Ends: Feb 15, 6pm EST",

  //event stuff

  Event: "A new event door has been opened O.O | Chat ab!event.claim to claim the rewards! (You can use it multiple times!) | Ends: ",

  Crypto: "A new event door has been opened O.O | Crypto prices are now increased! (every 2 minutes, the Crypto selling price will change!) | Ends: ",

  Learning: "A new event door has been opened O.O | ab!learn now gives more edu points! | Ends: ",

  PostEvent: "A new event door has been opened O.O | Posting and Chatting gives you more Post Money! | Ends: ",

  Work: "A new event door has been opened O.O | ab!work now gives more money! | Ends: ",

  EventEnd: "The event door has closed..."
}

var CryptoSell = 5

setInterval(function() {
  var CryptoRandom = getRandomInt(10)
  if (CryptoRandom <= 2) {
    if (CryptoEvent == false) {
      CryptoSell = 25
    } else {
      CryptoSell = 50
    }
  }
  if (CryptoRandom >= 3) {
    if (CryptoEvent == false) {
      CryptoSell = 5
    } else {
      CryptoSell = 10
    }
  }
}, 120000)


//data (always under data vars)
db.get("Likes").then(likes => {
  Likes = likes
  db.list().then(keys => { console.log(keys) });
});
db.get("Start").then(start => {
  PeopleStart = start
});

setInterval(function() {
  db.set("Likes", Likes).then(() => { });
}, 500)

//main vars
var NewUpdate = "0"
var Downtime = false

//events
var Event = false
var ExtraMoney = false
var CryptoEvent = true
var LearningEvent = true
var PostEvent = true
var PeopleEvent = false

//
var ClaimStop = 0
var PeopleStart = 0 //needs to be 6 people to start

//
//others

if (NewUpdate == "update") {
  client.onReady = () => {
    client.post(Running.Update)
    client.groups["61c75da8ebb7436adbfcd14c"].post(Running.Update + " | " + Update)
  }
}
if (NewUpdate == "normal") {
  client.onReady = () => {
    client.post(Running.Normal)
    client.groups["61c75da8ebb7436adbfcd14c"].post(Running.Normal)
  }
}
if (NewUpdate == "downtime") {
  client.onReady = () => {
    client.post(Running.Downtime)
    client.groups["61c75da8ebb7436adbfcd14c"].post(Running.Downtime)
  }
}
if (NewUpdate == "data") {
  client.onReady = () => {
    client.post(Running.DataUpdate)
    client.groups["61c75da8ebb7436adbfcd14c"].post(Running.DataUpdate + " | " + Update)
  }
}
if (NewUpdate == "event") {
  client.onReady = () => {
    client.post(Running.Event)
    client.groups["61c75da8ebb7436adbfcd14c"].post(Running.Event)
  }
}
if (NewUpdate == "eventremind") {
  client.onReady = () => {
    client.post(Running.EventRemind)
    client.groups["61c75da8ebb7436adbfcd14c"].post(Running.EventRemind)
  }
}
if (NewUpdate == "eventend") {
  client.onReady = () => {
    client.post(Running.EventEnd)
    client.groups["61c75da8ebb7436adbfcd14c"].post(Running.EventEnd)
  }
}

var date = new Date()

var Event1 = Running.Event + "Feb 8, 7pm EST"
var Sent1 = true

var Event2 = Running.Event + "Feb 11, 7pm EST"
var Sent2 = true

var Event3 = Running.Event + "Feb 13, 7pm EST"
var Sent3 = true

var Event4 = Running.Event + "Feb 15, 7pm EST"
var Sent4 = true

var Event5 = Running.Event + "Feb 18, 7pm EST"
var Sent5 = false

var Event6 = Running.Event + "Feb 20, 7pm EST"
var Sent6 = false

var Event7 = Running.Event + "Feb 22, 7pm EST"
var Sent7 = false

var Event8 = Running.Event + "Feb 25, 7pm EST"
var Sent8 = false

var Event9 = Running.Event + "Feb 27, 7pm EST"
var Sent9 = false

var Event10 = Running.Event + ", 7pm EST"
var Sent10 = false

var Event11 = Running.Event + ", 7pm EST"
var Sent11 = false

var Event12 = Running.Event + ", 7pm EST"
var Sent12 = false

var Event13 = Running.Event + ", 7pm EST"
var Sent13 = false

var Event14 = Running.Event + ", 7pm EST"
var Sent14 = false


setInterval(function() {
  //date stuff
  var Month = date.getMonth() + 1
  var Day = date.getDate()
  var Hour = date.getHours()
  var Seconds = date.getSeconds()
  var Minutes = date.getMinutes()
  //
  if (Month == 2) {

    if (Day == "7") {
      if (Hour >= "17") {
        Event = true
        if (Sent1 == false) {
          Sent1 = true
          client.onReady = () => {
            client.post(Event1)
            client.groups["61c75da8ebb7436adbfcd14c"].post(Event1)
          }
        }
      }
    } else {
      if (Day == "8") {
        if (Hour == "0") {
          if (Minutes == "1") {
            Sent1 = false
          }
        }
        if (Hour < "19") {
          Event = true
        } else {
          ClaimStop = 0
          Event = false
          if (Sent1 == false) {
            Sent1 = true
            client.onReady = () => {
              client.post(Running.EventEnd)
              client.groups["61c75da8ebb7436adbfcd14c"].post(Running.EventEnd)
            }
          }
        }
      }
    }

    if (Day == "10") {
      if (Hour >= "17") {
        Event = true
        if (Sent2 == false) {
          Sent2 = true
          client.onReady = () => {
            client.post(Event2)
            client.groups["61c75da8ebb7436adbfcd14c"].post(Event2)
          }
        }
      }
    } else {
      if (Day == "11") {
        if (Hour == "0") {
          if (Minutes == "1") {
            Sent2 = false
          }
        }
        if (Hour < "19") {
          Event = true
        } else {
          ExtraEvent = false
          Event = false
          ClaimStop = 0
          if (Sent2 == false) {
            Sent2 = true
            client.onReady = () => {
              client.post(Running.EventEnd)
              client.groups["61c75da8ebb7436adbfcd14c"].post(Running.EventEnd)
            }
          }
        }
      }
    }

    if (Day == "12") {
      if (Hour >= "17") {
        Event = true
        if (Sent3 == false) {
          Sent3 = true
          client.onReady = () => {
            client.post(Event3)
            client.groups["61c75da8ebb7436adbfcd14c"].post(Event3)
          }
        }
      }
    } else {
      if (Day == "13") {
        if (Hour == "0") {
          if (Minutes == "1") {
            Sent3 = false
          }
        }
        if (Hour < "19") {
          Event = true
        } else {
          Event = false
          ClaimStop = 0
          if (Sent3 == false) {
            Sent3 = true
            client.onReady = () => {
              client.post(Running.EventEnd)
              client.groups["61c75da8ebb7436adbfcd14c"].post(Running.EventEnd)
            }
          }
        }
      }
    }

    if (Day == "14") {
      if (Hour >= "17") {
        Event = true
        if (Sent4 == false) {
          Sent4 = true
          client.onReady = () => {
            client.post(Event4)
            client.groups["61c75da8ebb7436adbfcd14c"].post(Event4)
          }
        }
      }
    } else {
      if (Day == "15") {
        if (Hour == "0") {
          if (Minutes == "1") {
            Sent4 = false
          }
        }
        if (Hour < "19") {
          Event = true
        } else {
          Event = false
          ClaimStop = 0
          //
          CryptoEvent = false
          LearningEvent = false
          PostEvent = false
          //
          if (Sent4 == false) {
            Sent4 = true
            client.onReady = () => {
              client.post(Running.EventEnd)
              client.groups["61c75da8ebb7436adbfcd14c"].post(Running.EventEnd)
            }
          }
        }
      }
    }

    if (Day == "17") {
      if (Hour >= "17") {
        Event = true
        if (Sent5 == false) {
          Sent5 = true
          client.onReady = () => {
            client.post(Event5)
            client.groups["61c75da8ebb7436adbfcd14c"].post(Event5)
          }
        }
      }
    } else {
      if (Day == "18") {
        if (Hour == "0") {
          if (Minutes == "1") {
            Sent5 = false
          }
        }
        if (Hour < "19") {
          Event = true
        } else {
          Event = false
          ClaimStop = 0
          if (Sent5 == false) {
            Sent5 = true
            client.onReady = () => {
              client.post(Running.EventEnd)
              client.groups["61c75da8ebb7436adbfcd14c"].post(Running.EventEnd)
            }
          }
        }
      }
    }

    if (Day == "19") {
      if (Hour >= "17") {
        Event = true
        if (Sent6 == false) {
          Sent6 = true
          client.onReady = () => {
            client.post(Event6)
            client.groups["61c75da8ebb7436adbfcd14c"].post(Event6)
          }
        }
      }
    } else {
      if (Day == "20") {
        if (Hour == "0") {
          if (Minutes == "1") {
            Sent6 = false
          }
        }
        if (Hour < "19") {
          Event = true
        } else {
          Event = false
          ClaimStop = 0
          if (Sent6 == false) {
            Sent6 = true
            client.onReady = () => {
              client.post(Running.EventEnd)
              client.groups["61c75da8ebb7436adbfcd14c"].post(Running.EventEnd)
            }
          }
        }
      }
    }

    if (Day == "21") {
      if (Hour >= "17") {
        Event = true
        if (Sent7 == false) {
          Sent7 = true
          client.onReady = () => {
            client.post(Event7)
            client.groups["61c75da8ebb7436adbfcd14c"].post(Event7)
          }
        }
      }
    } else {
      if (Day == "22") {
        if (Hour == "0") {
          if (Minutes == "1") {
            Sent7 = false
          }
        }
        if (Hour < "19") {
          Event = true
        } else {
          Event = false
          ClaimStop = 0
          if (Sent7 == false) {
            Sent7 = true
            client.onReady = () => {
              client.post(Running.EventEnd)
              client.groups["61c75da8ebb7436adbfcd14c"].post(Running.EventEnd)
            }
          }
        }
      }
    }

    if (Day == "24") {
      if (Hour >= "17") {
        Event = true
        if (Sent8 == false) {
          Sent8 = true
          client.onReady = () => {
            client.post(Event8)
            client.groups["61c75da8ebb7436adbfcd14c"].post(Event8)
          }
        }
      }
    } else {
      if (Day == "25") {
        if (Hour == "0") {
          if (Minutes == "1") {
            Sent8 = false
          }
        }
        if (Hour < "19") {
          Event = true
        } else {
          Event = false
          ClaimStop = 0
          if (Sent8 == false) {
            Sent8 = true
            client.onReady = () => {
              client.post(Running.EventEnd)
              client.groups["61c75da8ebb7436adbfcd14c"].post(Running.EventEnd)
            }
          }
        }
      }
    }

  }
}, 1000)


function RankSet() {
  //owner stuff

  /*Abooby*/  db.set("6154f0d0a8d6d106c5b869b6Role", "Owner").then(() => { })

  /*Bot */ db.set("61c60d39e1e6417b595cfd19Role", "Bot").then(() => { })

  //specials

  /*flurri*/ db.set("61998d154ef0457408274fd6Role", "Special").then(() => { })

  /*WUTAdam */ db.set("60bd0243edf9d8003785ad79Role", "Special").then(() => { })

  /*Red */ db.set("61b4520e4ea86c6fe9800c3bRole", "Special").then(() => { })

  /*steep */ db.set("61d6f884ae777c689f511205Role", "Special").then(() => { })

  //premium

    /*Robot_Engine*/ db.set("6066b99198895e660082965bRole", "Premium").then(() => { })

  //banned

  /*zgr dude */ db.set("615633bcf03ce145ddce4708Role", "Banned").then(() => { })
}

/*
Plans:

1. add more stuff to buy with post money 

2. relationships (ab!marry: will give a name and descirption of the person your marrying | when you work and you are married, you get $0.01 more from the pay | there will be special people when you have premium)

4. If your using the bot in the AbicamBot group, you will get extra stuff (maybe ab!group.claim)

*/


/*
command creating:

if (chat.text.startsWith(Prefix + "command")) {
  db.get(chat.user.id + "Role").then(role => {
    if (role != "Banned") {
      //command stuff
    } else {
      chat.reply("Very sorry but you are banned from AbicamBot...")
    }
  })
}

post.chat = chat
client.post = post
*/


client.onPost = (post) => {
  //normal
  async function DataStart() {
    const moneypost = await db.get(post.author.id + "MoneyPost")
    const money = await db.get(post.author.id + "Money")
    const edupoints = await db.get(post.author.id + "edupoints")
    const crypto = await db.get(post.author.id + "Crypto")
    const wins = await db.get(post.author.id + "Wins")
    const loses = await db.get(post.author.id + "Loses")
    const happy = await db.get(post.author.id + "HappyPoints")
    const role = await db.get(post.author.id + "Role")
    const level = await db.get(post.author.id + "level")
    const food = await db.get(post.author.id + "FoodPTS")
    const scrolls = await db.get(post.author.id + "scrolls")
    const coins = await db.get(post.author.id + "coins")
    const energy = await db.get(post.author.id + "energy")
    db.set(post.author.id + "scrolls", scrolls).then(() => {
      db.set(post.author.id + "coins", coins).then(() => {
        db.set(post.author.id + "energy", energy).then(() => {
          db.set(post.author.id + "MoneyPost", moneypost).then(() => {
            db.set(post.author.id + "Money", money).then(() => {
              db.set(post.author.id + "edupoints", edupoints).then(() => {
                db.set(post.author.id + "Crypto", crypto).then(() => {
                  db.set(post.author.id + "Wins", wins).then(() => {
                    db.set(post.author.id + "Loses", loses).then(() => {
                      db.set(post.author.id + "Role", role).then(() => {
                        db.set(post.author.id + "level", level).then(() => {
                          db.set(post.author.id + "HappyPoints", happy).then(() => {
                            db.set(post.author.id + "FoodPTS", food).then(() => {
                              db.list().then(keys => { console.log(keys) });
                              post.chat("Your AbicamBot account has been made/updated!")
                              RankSet()
                            })
                          })
                        })
                      })
                    })
                  })
                })
              })
            })
          })
        })
      })
    })
  }


  async function DataGet(command) {
    if (command == "money") {
      db.get(post.author.id + "Money").then(money => {return money})
    }
  }

  console.log(DataGet("money"))

  db.get(post.author.id + "Role").then(role => {
    if (role != "Banned") {
      if (post.text.match(Prefix + "connect")) {
        post.connect()
        DataStart()
        if (role != "Premium" && role != "Owner" && role != "Bot") {
          var AD = setInterval(function() {
            var AdRandom = getRandomInt(15)
            if (AdRandom == 1) {
              var AdRandom2 = getRandomInt(2)
              if (AdRandom2 == 0) {
                post.chat("Advertisement: Go to https://www.patreon.com/abicambot")
                clearInterval(AD)
                setTimeout(function() {
                  AD
                }, 10000)
              }
              if (AdRandom2 == 1) {
                post.chat("Advertisement: Follow @Abooby!")
                clearInterval(AD)
                setTimeout(function() {
                  AD
                }, 10000)
              }
              if (AdRandom2 == 2) {
                post.chat("Advertisement: Join the AbicamBot group! https://app.photop.live/?j=3b108ba9")
                clearInterval(AD)
                setTimeout(function() {
                  AD
                }, 10000)
              }
            }
          }, 5000)
        }
        if (post.author.id != "6154f0d0a8d6d106c5b869b6") {
          if (Downtime == false) {
            post.connect()
            post.chat("Im connected to your post " + post.author.username + "! | Prefix: ab! | Use ab!hpn for normal command help | Use ab!hpg for gambling help! | Use ab!hpm for post money help!")
            setTimeout(function() {
              post.chat(" | Use ab!hpk for Kimburlia help!")
            }, 1000)
          } else {
            post.chat("AbicamBot is currently in downtime! (You can still earn post money from posts but not from chats)")
          }
        }
        if (post.author.id == "61998d154ef0457408274fd6") {
          //flurri
          post.chat("mcflurri coming right up!")
        }
        if (post.author.id == "61b4520e4ea86c6fe9800c3b") {
          //Red
          post.chat("Hello Sockbot creator! ðŸ˜¶â€ðŸŒ«ï¸")
        }
        if (post.author.id == "60bd0243edf9d8003785ad79") {
          //WUTAdam
          post.chat("HMMMMMMMMMM, wut are you doing here?")
        }
        if (post.author.id == "6066b99198895e660082965b") {
          //Robot
          post.chat("Hello creator of Photop!")
        }
        if (post.author.id == "6154f0d0a8d6d106c5b869b6") {
          //Abooby
          post.chat("Hello my king!")
          post.connect()
        }

      } else {
        if (post.text.match(/[a-zA-Z0-9]/)) {
          if (post.author.id == "61d7c2bb17f63f50a3f6ee5c") {
            var Random = getRandomInt(4)
            if (Random == 0) {
              post.chat("cringe")
            }
            if (Random == 1) {
              post.chat("Cringest post in all of Photop ðŸ’€")
            }
            if (Random == 2) {
              post.chat("This post = cringe")
            }
            if (Random == 3) {
              post.chat("Cringy")
            }
            if (Random == 4) {
              post.chat("Cringe is taking over")
            }
          }
        }
      }
    } else {
      post.chat("Very sorry but you are banned from AbicamBot...")
    }
  })
  //command using
  post.onChat = (chat) => {
    /*
    ranks: 
    1. Owner
    2. Premium
    3. Special
    4. Normal
    5. Banned
    */
    //testing
    if (chat.text.startsWith(Prefix + "test")) {
      db.get(chat.user.id + "Role").then(role => {
        if (role == "Owner") {
          chat.reply(DataGet("money"))
        } else {
          chat.reply("You dont have the rank to run this command...")
        }
      })
    }

    //post money
    if (chat.text.match(/ab\![a-zA-Z0-9]/)) {
      db.get(chat.user.id + "Role").then(role => {
        if (role != "Banned") {
          db.get(chat.user.id + "MoneyNorm").then(money => {
            db.get(chat.user.id + "level").then(level => {
              if (PostEvent == false) {
                money = money + 0.02
                level = level + 0.01
              } else {
                money = money + 0.04
                level = level + 0.02
              }
              db.set(chat.user.id + "MoneyNorm", money).then(() => {
                db.set(chat.user.id + "level", level).then(() => {

                })
              })
            })
          })
        } else {
          post.chat("Very sorry but you are banned from AbicamBot...")
        }
      })
    }
    if (chat.text.startsWith(Prefix + "hpm")) {
      post.chat("Use ab!hpc + page number to get help! | Example: ab!hpc1 | To get money just post and chat! | Max pages: 2")
    }
    if (chat.text.startsWith(Prefix + "hpc1")) {
      post.chat(Hpc1)
    }
    if (chat.text.startsWith(Prefix + "hpc2")) {
      post.chat(Hpc2)
    }
    if (chat.text.startsWith(Prefix + "post.money")) {
      db.get(chat.user.id + "MoneyNorm").then(money => {
        chat.reply("You have $" + money.toFixed(2))
      })
    }
    //add stuff buying here
    if (chat.text.startsWith(Prefix + "buy.money1")) {
      db.get(chat.user.id + "Role").then(role => {
        if (role != "Banned") {
          db.get(chat.user.id + "MoneyNorm").then(moneynorm => {
            db.get(chat.user.id + "Money").then(money => {
              if (moneynorm >= 10) {
                money = money + 1
                moneynorm = moneynorm - 10
                chat.reply("Added $1 to your gamble account!")
                db.set(chat.user.id + "Money", money).then(() => { })
                db.set(chat.user.id + "MoneyNorm", moneynorm).then(() => { })
              } else {
                chat.reply("You dont have enought post money (You need $10 to buy)")
              }
            })
          })
        } else {
          post.chat("Very sorry but you are banned from AbicamBot...")
        }
      })
    }
    if (chat.text.startsWith(Prefix + "buy.money5")) {
      db.get(chat.user.id + "Role").then(role => {
        if (role != "Banned") {
          db.get(chat.user.id + "MoneyNorm").then(moneynorm => {
            db.get(chat.user.id + "Money").then(money => {
              if (moneynorm >= 50) {
                money = money + 5
                moneynorm = moneynorm - 50
                chat.reply("Added $5 to your gamble account!")
                db.set(chat.user.id + "Money", money).then(() => { })
                db.set(chat.user.id + "MoneyNorm", moneynorm).then(() => { })
              } else {
                chat.reply("You dont have enought post money (You need $50 to buy)")
              }
            })
          })
        }
      })
    }
    if (chat.text.startsWith(Prefix + "level")) {
      db.get(chat.user.id + "level").then(level => {
        chat.reply("You are currently level " + level.toFixed(2))
      })
    }
    if (chat.text.startsWith(Prefix + "buy.post.money")) {
      db.get(chat.user.id + "Role").then(role => {
        if (role != "Banned") {
          db.get(chat.user.id + "level").then(level => {
            db.get(chat.user.id + "MoneyNorm").then(money => {
              if (level >= 5) {
                money = money + 1
                level = level - 5
                chat.reply("1 post dollar added to your account!")
                db.set(chat.user.id + "level", level).then(() => {
                  db.set(chat.user.id + "MoneyNorm", money).then(() => { })
                })
              } else {
                chat.reply("You dont have enough levels...")
              }
            })
          })
        } else {
          chat.reply("Very sorry but you are banned from AbicamBot...")
        }
      })
    }
    //help
    if (chat.text.startsWith(Prefix + "hpn")) {
      post.chat("Use ab!hpa + page number to get help! | Example: ab!hpa1 | Max pages: 3")
    }
    if (chat.text.startsWith(Prefix + "hpa1")) {
      post.chat(Hpa1)
    }
    if (chat.text.startsWith(Prefix + "hpa2")) {
      post.chat(Hpa2)
    }
    if (chat.text.startsWith(Prefix + "hpa3")) {
      post.chat(Hpa3)
    }
    //normal
    if (chat.text.startsWith(Prefix + "update")) {
      post.chat(Update)
    }
    if (chat.text.startsWith(Prefix + "sus")) {
      chat.reply("That's sussy step bro!")
    }
    if (chat.text.startsWith(Prefix + "robot_engine")) {
      chat.reply("Master of all Robots! Why doesnt he have a command prefix like me?")
    }
    if (chat.text.startsWith(Prefix + "wutbot")) {
      chat.reply("A bot that overdoes things...")
    }
    if (chat.text.startsWith(Prefix + "pyx")) {
      chat.reply("Very good bot that was made by flurri, my second creator | usually abused")
    }
    if (chat.text.startsWith(Prefix + "like")) {
      Likes = Likes + 1
      chat.reply("Thank you for liking AbicamBot! AbicamBot has: " + Likes + " likes!")
    }
    if (chat.text.startsWith(Prefix + "post.like")) {
      chat.post.like()
      chat.reply("I liked the post!")
    }
    if (chat.text.startsWith(Prefix + "post.unlike")) {
      chat.post.unlike()
      chat.reply("I hate this command...")
    }
    if (chat.text.startsWith(Prefix + "random.num")) {
      chat.reply("Your lucky number: " + getRandomInt(9999))
    }
    if (chat.text.startsWith(Prefix + "claim")) {
      db.get(chat.user.id + "Role").then(role => {
        if (role != "Banned") {
          if (role == "Premium" || role == "Owner") {
            db.get(chat.user.id + "Money").then(money => {
              db.get(chat.user.id + "level").then(level => {
                db.get(chat.user.id + "MoneyNorm").then(moneynorm => {
                  chat.reply("Claiming...")
                  setTimeout(function() {
                    money = money + 0.02
                    moneynorm = moneynorm + 0.05
                    level = level + 0.05
                    chat.reply("You claimed $0.02 money, $0.05 post money and 0.05 levels!")
                    db.set(chat.user.id + "Money", money).then(() => {
                      db.set(chat.user.id + "MoneyNorm", moneynorm).then(() => {
                        db.set(chat.user.id + "level", level).then(() => { })
                      })
                    })
                  }, 5000)
                })
              })
            })
          } else {
            chat.reply("This command is only available to people with AbicamBot Premium! (Want premium? Check: https://www.patreon.com/abicambot)")
          }
        } else {
          chat.reply("Very sorry but you are banned from AbicamBot...")
        }
      })
    }
    if (chat.text.startsWith(Prefix + "rank.info")) {
      db.get(chat.user.id + "Role").then(role => {
        chat.reply("You currently have rank: " + role + " | Ranks: Owner, Premium, Special, Normal")
      })
    }
    if (chat.text.startsWith(Prefix + "event.claim")) {
      db.get(chat.user.id + "Role").then(role => {
        if (role != "Banned") {
          if (Event == true || PeopleEvent == true) {
            db.get(chat.user.id + "MoneyNorm").then(moneynorm => {
              db.get(chat.user.id + "Money").then(money => {
                db.get(chat.user.id + "level").then(level => {
                  if (ClaimStop <= 99) {
                    ClaimStop = ClaimStop + 1
                    chat.reply("Claiming...")
                    setTimeout(function() {
                      //event reward code
                      money = money + 0.05
                      level = level + 0.01
                      moneynorm = moneynorm + 0.02
                      chat.reply("You claimed the event rewards! (You can keep collecting!)")
                      //event reward code
                      db.set(chat.user.id + "MoneyNorm", moneynorm).then(() => {
                        db.set(chat.user.id + "Money", money).then(() => {
                          db.set(chat.user.id + "level", level).then(() => {
                          })
                        })
                      })
                    }, 5000)
                  } else {
                    chat.reply("ab!event.claim has reached its max (100 uses) please wait until the next event for it to be refreshed!")
                  }
                })
              })
            })
          } else {
            chat.reply("The event has ended")
          }
        } else {
          chat.reply("Very sorry but you are banned from AbicamBot...")
        }
      })
    }

    if (chat.text.startsWith(Prefix + "start")) {
      db.get("Start").then(start => {
        if (start <= 4) {
          start = start + 1
          StartAmount = 6 - start
          chat.reply("You have touched the event stone and its starting to glow! | You need " + StartAmount + " more people to open the door!")
          db.set("Start", start).then(() => { })
        } else {
          if (PeopleEvent == false) {
            chat.reply("You opened the event door :O")
            db.set("Start", start).then(() => { })
            PeopleEvent = true
            client.post(chat.user.username + " has opened an event door! | use ab!event.claim to claim rewards! (you only got 10 minutes!)")
            client.groups["61c75da8ebb7436adbfcd14c"].post(chat.user.username + " has opened an event door! | use ab!event.claim to claim rewards! (you only got 10 minutes!)")
            setTimeout(function() {
              PeopleEvent = false
              start = 0
              db.set("Start", 0).then(() => { })
              client.post("The people event door has closed! | Use ab!start to open it back up!")
              client.groups["61c75da8ebb7436adbfcd14c"].post("The people event door has closed! | Use ab!start to open it back up!")
            }, 600000)
          } else {
            chat.reply("The event door is already opened! | Use ab!event.claim to claim the rewards!")
          }
        }
      })
    }

    //gamble game
    //help
    if (chat.text.startsWith(Prefix + "hpg")) {
      post.chat("Use ab!hpb + page number to get help! | Example: ab!hpb1 | Max pages: 5")
    }
    if (chat.text.startsWith(Prefix + "hpb1")) {
      post.chat(Hpb1)
    }
    if (chat.text.startsWith(Prefix + "hpb2")) {
      post.chat(Hpb2)
    }
    if (chat.text.startsWith(Prefix + "hpb3")) {
      post.chat(Hpb3)
    }
    if (chat.text.startsWith(Prefix + "hpb4")) {
      post.chat(Hpb4)
    }
    if (chat.text.startsWith(Prefix + "hpb5")) {
      post.chat(Hpb5)
    }
    if (chat.text.startsWith(Prefix + "hpb6")) {
      post.chat(Hpb6)
    }
    //main commands
    if (chat.text.startsWith(Prefix + "edu.points")) {
      db.get(chat.user.id + "edupoints").then(edupoints => {
        chat.reply("You have " + edupoints + " edu points!")
      })
    }
    if (chat.text.startsWith(Prefix + "money")) {
      db.get(chat.user.id + "Money").then(money => {
        chat.reply("You have $" + money.toFixed(2))
      })
    }
    if (chat.text.startsWith(Prefix + "wins")) {
      db.get(chat.user.id + "Wins").then(wins => {
        chat.reply("You have " + wins + " wins!")
      })
    }
    if (chat.text.startsWith(Prefix + "loses")) {
      db.get(chat.user.id + "Loses").then(loses => {
        chat.reply("You have " + loses + " loses")
      })
    }
    if (chat.text.startsWith(Prefix + "gamble")) {
      db.get(chat.user.id + "Role").then(role => {
        if (role != "Banned") {
          db.get(chat.user.id + "Money").then(money => {
            db.get(chat.user.id + "Wins").then(wins => {
              db.get(chat.user.id + "Loses").then(loses => {
                if (money >= 5) {
                  money = money - 5
                  var GambleRandom = getRandomInt(5)
                  if (GambleRandom <= 3) {
                    wins = wins + 1
                    money = money + 8
                    chat.reply("You won the gamble!")
                  } else {
                    loses = loses + 1
                    chat.reply("You lost the gamble...")
                  }
                } else {
                  chat.reply("You dont have enough money...")
                }
                db.set(chat.user.id + "Money", money).then(() => {
                  db.set(chat.user.id + "Wins", wins).then(() => {
                    db.set(chat.user.id + "Loses", loses).then(() => {

                    })
                  })
                })
              })
            })
          })
        } else {
          chat.reply("Very sorry but you are banned from AbicamBot...")
        }
      })
    }
    if (chat.text.startsWith(Prefix + "work")) {
      db.get(chat.user.id + "edupoints").then(edupoints => {
        db.get(chat.user.id + "Money").then(money => {
          db.get(chat.user.id + "Role").then(role => {
            db.get(chat.user.id + "FoodPTS").then(food => {
              if (role != "Banned") {
                if (role == "Owner" || role == "Premium" || role == "Special") {
                  if (food >= 50) {
                    money = money + 0.05
                  } else {
                    money = money + 0.03
                  }
                }
                if (ExtraMoney == true) {
                  if (food >= 50) {
                    var MoneyGain = edupoints * 0.04 + 0.01
                  } else {
                    var MoneyGain = edupoints * 0.04
                  }
                  money = money + MoneyGain
                } else {
                  if (food >= 50) {
                    var MoneyGain = edupoints * 0.02 + 0.01
                  } else {
                    var MoneyGain = edupoints * 0.02
                  }
                  money = money + MoneyGain
                }
                chat.reply("Working...")
                setTimeout(function() {
                  if (role == "Special" || role == "Premium" || role == "Owner") {
                    if (food >= 50) {
                      chat.reply("You worked and earned $" + MoneyGain + " | You got $0.05 extra for having a special rank!")
                    } else {
                      chat.reply("You worked and earned $" + MoneyGain + " | You got $0.03 extra for having a special rank!")
                    }
                    if (food >= 10) {
                      food = food - 10
                    } else {
                      food = 0
                    }
                  } else {
                    if (food >= 50) {
                      chat.reply("You worked and earned $" + MoneyGain + " | You earned $0.01 more for your excitement")
                    } else {
                      chat.reply("You worked and earned $" + MoneyGain)
                    }
                    if (food >= 10) {
                      food = food - 10
                    } else {
                      food = 0
                    }
                  }
                  db.set(chat.user.id + "Money", money).then(() => {
                    db.set(chat.user.id + "FoodPTS", food).then(() => { })
                  })
                }, 5000)
              } else {
                chat.reply("Very sorry but you are banned from AbicamBot...")
              }
            })
          })
        })
      })
    }
    if (chat.text.startsWith(Prefix + "learn")) {
      db.get(chat.user.id + "Role").then(role => {
        if (role != "Banned") {
          db.get(chat.user.id + "edupoints").then(edupoints => {
            db.get(chat.user.id + "FoodPTS").then(food => {
              chat.reply("Learning...")
              var LearnRandom = getRandomInt(10)
              setTimeout(function() {
                if (LearnRandom <= 7) {
                  var EduGain = 1
                  if (LearningEvent == false) {
                    if (food >= 90) {
                      EduGain = 2
                    } else {
                      EduGain = 1
                    }
                  } else {
                    if (food >= 90) {
                      EduGain = 4
                    } else {
                      EduGain = 2
                    }
                  }
                  edupoints = edupoints + EduGain
                  chat.reply("You were paying attention in class and earned " + EduGain + " edu points!")
                  db.set(chat.user.id + "edupoints", edupoints).then(() => { })
                } else {
                  if (edupoints <= 1) {
                    edupoints = 0
                  } else {
                    edupoints = edupoints - 2
                  }
                  chat.reply("You were not paying attention in class, you lost 2 edu points")
                  db.set(chat.user.id + "edupoints", edupoints).then(() => { })
                }
              }, 5000)
            })
          })
        } else {
          chat.reply("Very sorry but you are banned from AbicamBot...")
        }
      })
    }
    if (chat.text.startsWith(Prefix + "sell.crypto")) {
      db.get(chat.user.id + "Role").then(role => {
        if (role != "Banned") {
          db.get(chat.user.id + "Crypto").then(crypto => {
            db.get(chat.user.id + "Money").then(money => {
              if (crypto >= 1) {
                chat.reply("Selling Crypto...")
                setTimeout(function() {
                  chat.reply("You sold all of your Crypto for " + CryptoSell + "!")
                }, 2000)
              } else {
                chat.reply("You dont have crypto...")
              }
            })
          })
        } else {
          chat.reply("Very sorry but you are banned from AbicamBot...")
        }
      })
    }
    if (chat.text.startsWith(Prefix + "crypto.info")) {
      db.get(chat.user.id + "Crypto").then(crypto => {
        chat.reply("Crypto is selling for $" + CryptoSell + "! | You have " + crypto + " Crypto!")
      })
    }
    if (chat.text.startsWith(Prefix + "buy.crypto")) {
      db.get(chat.user.id + "Role").then(role => {
        if (role != "Banned") {
          db.get(chat.user.id + "Money").then(money => {
            db.get(chat.user.id + "Crypto").then(crypto => {
              if (money >= CryptoSell) {
                money = money - CryptoSell
                crypto = crypto + 1
                chat.reply("You bought 1 Crypto!")
                db.set(chat.user.id + "Crypto", crypto).then(() => {
                  db.set(chat.user.id + "Money", money).then(() => {

                  })
                })
              } else {
                chat.reply("You dont have enough money...")
              }
            })
          })
        }
      })
    }

    if (chat.text.startsWith(Prefix + "play")) {
      db.get(chat.user.id + "Role").then(role => {
        if (role != "Banned") {
          db.get(chat.user.id + "HappyPoints").then(happypoints => {
            if (role == "Owner" || role == "Premium") {
              var HappyStuff = getRandomInt(15)
            } else {
              var HappyStuff = getRandomInt(10)
            }
            if (HappyStuff == 0) {
              chat.reply("You couldnt find any game to play...")
            }
            if (HappyStuff == 1) {
              if (role == "Premium" || role == "Owner") {
                var HappyEarn = getRandomInt(4)
              } else {
                var HappyEarn = getRandomInt(2)
              }
              happypoints = happypoints + HappyEarn
              chat.reply("You played Fortnite and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            if (HappyStuff == 2) {
              if (role == "Premium" || role == "Owner") {
                var HappyEarn = getRandomInt(10)
              } else {
                var HappyEarn = getRandomInt(5)
              }
              happypoints = happypoints + HappyEarn
              chat.reply("You played Roblox and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            if (HappyStuff == 3) {
              if (role == "Premium" || role == "Owner") {
                var HappyEarn = getRandomInt(40)
              } else {
                var HappyEarn = getRandomInt(20)
              }
              happypoints = happypoints + HappyEarn
              chat.reply("You played Photop and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            if (HappyStuff == 4) {
              if (role == "Premium" || role == "Owner") {
                var HappyEarn = getRandomInt(20)
              } else {
                var HappyEarn = getRandomInt(10)
              }
              happypoints = happypoints + HappyEarn
              chat.reply("You played AFK Arena and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            if (HappyStuff == 5) {
              if (role == "Premium" || role == "Owner") {
                var HappyEarn = getRandomInt(20)
              } else {
                var HappyEarn = getRandomInt(10)
              }
              happypoints = happypoints + HappyEarn
              chat.reply("You streamed on Discord and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            if (HappyStuff == 6) {
              if (role == "Premium" || role == "Owner") {
                var HappyEarn = getRandomInt(30)
              } else {
                var HappyEarn = getRandomInt(15)
              }
              happypoints = happypoints + HappyEarn
              chat.reply("You streamed on YouTube and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            if (HappyStuff == 7) {
              if (role == "Premium" || role == "Owner") {
                var HappyEarn = getRandomInt(10)
              } else {
                var HappyEarn = getRandomInt(5)
              }
              happypoints = happypoints + HappyEarn
              chat.reply("You streamed on Twitch and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            if (HappyStuff == 8) {
              if (role == "Premium" || role == "Owner") {
                var HappyEarn = getRandomInt(10)
              } else {
                var HappyEarn = getRandomInt(5)
              }
              happypoints = happypoints + HappyEarn
              chat.reply("You played GTA V and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            if (HappyStuff == 9) {
              if (role == "Premium" || role == "Owner") {
                var HappyEarn = getRandomInt(40)
              } else {
                var HappyEarn = getRandomInt(20)
              }
              happypoints = happypoints + HappyEarn
              chat.reply("You played PokÃ©mon Legends: Arceus and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            if (HappyStuff == 10) {
              if (role == "Premium" || role == "Owner") {
                var HappyEarn = getRandomInt(20)
              } else {
                var HappyEarn = getRandomInt(10)
              }
              happypoints = happypoints + HappyEarn
              chat.reply("You played Rocket League and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            //premium games
            if (HappyStuff == 11) {
              var HappyEarn = getRandomInt(100)
              happypoints = happypoints + HappyEarn
              chat.reply("You played Homba 20 and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            if (HappyStuff == 12) {
              var HappyEarn = getRandomInt(150)
              happypoints = happypoints + HappyEarn
              chat.reply("You played Rocket League 2 and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            if (HappyStuff == 13) {
              var HappyEarn = getRandomInt(100)
              happypoints = happypoints + HappyEarn
              chat.reply("You played DeathStar and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            if (HappyStuff == 14) {
              var HappyEarn = getRandomInt(150)
              happypoints = happypoints + HappyEarn
              chat.reply("You played Bortnite and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
            if (HappyStuff == 15) {
              var HappyEarn = getRandomInt(100)
              happypoints = happypoints + HappyEarn
              chat.reply("You played Pokemon Teal and Blue and earned " + HappyEarn + " happy points!")
              db.set(chat.user.id + "HappyPoints", happypoints).then(() => {

              })
            }
          })
        } else {
          chat.reply("Very sorry but you are banned from AbicamBot...")
        }
      })
    }
    if (chat.text.startsWith(Prefix + "happy.points")) {
      db.get(chat.user.id + "HappyPoints").then(happypoints => {
        chat.reply("You have " + happypoints + " happy points!")
      })
    }

    if (chat.text.startsWith(Prefix + "cook")) {
      db.get(chat.user.id + "FoodPTS").then(food => {
        db.get(chat.user.id + "Role").then(roleget => {
          db.get(chat.user.id + "Money").then(money => {
            db.get(chat.user.id + "HappyPoints").then(happy => {
              role = roleget.toLowerCase();
              if (role != "banned") {
                if (money >= 2) {
                  money = money - 2
                  post.chat("Cooking!")
                  if (role == "premium" || role == "owner") {
                    FoodGain = happy * 4
                    food = food + FoodGain
                  } else {
                    FoodGain = happy * 2
                    food = food + FoodGain
                  }
                  setTimeout(function() {
                    chat.reply("You cooked a meal and got " + FoodGain + " food points!")
                    db.set(chat.user.id + "FoodPTS", food).then(() => {
                      db.set(chat.user.id + "Money", money).then(() => { })
                    })
                  }, 5000)
                } else {
                  chat.reply("You dont have the money to cook...")
                }
              } else {
                chat.reply("Very sorry but you are banned from AbicamBot...")
              }
            })
          })
        })
      })
    }
    if (chat.text.startsWith(Prefix + "food.points")) {
      db.get(chat.user.id + "FoodPTS").then(food => {
        chat.reply("You have " + food + " food points!")
      })
    }

    //Kimburlia
    if (chat.text.startsWith(Prefix + "hpk")) {
      post.chat("Use ab!hpd + page number to get help! | Example: ab!hpd1 | Max pages: 2")
    }
    if (chat.text.startsWith(Prefix + "hpd1")) {
      post.chat(Hpd1)
    }
    if (chat.text.startsWith(Prefix + "hpd2")) {
      post.chat(Hpd2)
    }
    if (chat.text.startsWith(Prefix + "scrolls")) {
      db.get(chat.user.id + "scrolls").then(scrolls => {
        post.chat("You have " + scrolls + " scrolls!")
      })
    }
    if (chat.text.startsWith(Prefix + "coins")) {
      db.get(chat.user.id + "coins").then(coins => {
        post.chat("You have " + coins + " coins!")
      })
    }
    if (chat.text.startsWith(Prefix + "energy")) {
      db.get(chat.user.id + "energy").then(energy => {
        post.chat("You have " + energy + " energy!")
      })
    }
    if (chat.text.startsWith(Prefix + "fight")) {
      db.get(chat.user.id + "Role").then(role => {
        if (role != "Banned") {
          db.get(chat.user.id + "scrolls").then(scrolls => {
            db.get(chat.user.id + "coins").then(coins => {
              db.get(chat.user.id + "energy").then(energy => {
                if (energy >= 5) {
                  chat.reply("Fighting...")
                  setTimeout(function() {
                    coins = coins + 0.02
                    scrolls = scrolls + 0.01
                    if (role == "Owner" || role == "Premium" || role == "Special") {
                      coins = coins + 0.01
                      chat.reply("You got 0.02 coins and 1 scroll peice! Also, since you have a special rank, you got 0.01 coins!")
                    } else {
                      chat.reply("You got 0.02 coins and 1 scroll peice!")
                    }
                    db.set(chat.user.id + "coins", coins).then(() => {
                      db.set(chat.user.id + "scrolls", scrolls).then(() => {
                        db.set(chat.user.id + "energy", energy).then(() => {

                        })
                      })
                    })
                  }, 5000)
                } else {
                  chat.reply("You dont have enough energy... (summon for energy!)")
                }
              })
            })
          })
        }
      })
    }
    if (chat.text.startsWith(Prefix + "summon")) {
      db.get(chat.user.id + "Role").then(role => {
        if (role != "Banned") {
          db.get(chat.user.id + "scrolls").then(scrolls => {
            db.get(chat.user.id + "coins").then(coins => {
              db.get(chat.user.id + "energy").then(energy => {
                if (scrolls >= 1) {
                  if (coins >= 5) {
                    var EnergyEarn = getRandomInt(10)
                    energy = energy + EnergyEarn
                    chat.reply("You got " + EnergyEarn + " energy!")
                    db.set(chat.user.id + "scrolls", scrolls).then(() => {
                      db.set(chat.user.id + "coins", coins).then(() => {
                        db.set(chat.user.id + "energy", energy).then(() => {

                        })
                      })
                    })
                  } else {
                    chat.reply("You dont have enough coins...")
                  }
                } else {
                  chat.reply("You dont have enough scrolls")
                }
              })
            })
          })
        }
      })
    }
  }
}

require('./server')();